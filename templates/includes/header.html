{% load static %}
<link href="https://db.onlinewebfonts.com/c/eba6ff471b149c188c89337749e3dc23?family=VAG+Rounded+BT" rel="stylesheet">
<header class="header">
    <div id="online-user-count" class="header__online-user-count"></div>
    <div class="header__brand-section">
        <a class="header__brand" href="/">
            <img class="header__title" src="{% static 'images/logo/Monkey_Snowfight.svg' %}" alt="Monkey Snowfight">
            <img class="header__title--small" src="{% static 'images/logo/monkeyhome.jpg' %}" alt="Monkey Snowfight">
        </a>
    </div>
    <div class="header__nav-section">
    <nav>
        <ul class="header__nav">
            {% if request.user.is_authenticated %}

            <li class="header__nav-item dropdown">
                <a onclick="toggleDropdown('chat-dropdown')" class="header__nav-link">
                    <div id="online-in-chats"></div>
                    Chat
                    <img id="chat-arrow" class="header__arrow"
                        src="https://img.icons8.com/small/32/ffffff/expand-arrow.png" alt="Dropdown" />
                </a>
                <div id="chat-dropdown" class="dropdown__content dropdown__content--hidden">
                    <ul id="chats-list" class="dropdown__list"></ul>
                </div>
            </li>

            <li class="header__nav-item dropdown">
                <a onclick="toggleDropdown('user-dropdown')" class="header__nav-link">
                    <img class="header__avatar" src="{{ request.user.profile.avatar }}" alt="Avatar" />
                    {{ request.user.profile.name }}
                    <img id="user-arrow" class="header__arrow"
                        src="https://img.icons8.com/small/32/ffffff/expand-arrow.png" alt="Dropdown" />
                </a>
                <div id="user-dropdown" class="dropdown__content dropdown__content--hidden">
                    <ul class="dropdown__list">
                        <li class="dropdown__item"><a class="dropdown__link" href="{% url 'profile' %}">My Profile</a></li>
                        <li class="dropdown__item"><a class="dropdown__link" href="{% url 'profile-edit' %}">Edit Profile</a></li>
                        <li class="dropdown__item"><a class="dropdown__link" href="{% url 'new-groupchat' %}">Create Chat</a></li>
                        <li class="dropdown__item"><a class="dropdown__link" href="{% url 'profile-settings' %}">Settings</a></li>
                        <li class="dropdown__item"><a class="dropdown__link" href="{% url 'account_logout' %}">Log Out</a></li>
                    </ul>
                </div>
            </li>

            {% else %}
            <li class="header__nav-item"><a class="header__nav-link" href="{% url 'account_login' %}">Login</a></li>
            <li class="header__nav-item"><a class="header__nav-link" href="{% url 'account_signup' %}?next={% url 'profile-onboarding' %}">Signup</a></li>
            {% endif %}
        </ul>
    </nav>
    </div>
</header>

<script>
// Dropdown functionality
function toggleDropdown(dropdownId) {
    const dropdown = document.getElementById(dropdownId);
    const arrow = dropdownId === 'chat-dropdown' ? document.getElementById('chat-arrow') : document.getElementById('user-arrow');
    
    // Close all other dropdowns first
    document.querySelectorAll('.dropdown__content').forEach(d => {
        if (d.id !== dropdownId) {
            d.classList.add('dropdown__content--hidden');
        }
    });
    
    // Reset all arrows
    document.querySelectorAll('#chat-arrow, #user-arrow').forEach(a => {
        if (a !== arrow) {
            a.classList.remove('header__arrow--rotated');
        }
    });
    
    // Toggle current dropdown
    dropdown.classList.toggle('dropdown__content--hidden');
    arrow.classList.toggle('header__arrow--rotated');
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown__content').forEach(d => {
            d.classList.add('dropdown__content--hidden');
        });
        document.querySelectorAll('#chat-arrow, #user-arrow').forEach(a => {
            a.classList.remove('header__arrow--rotated');
        });
    }
});
</script>